<Class>
    <Id>742</Id>
    <Package>org.apache.pig.backend.hadoop.executionengine.tez.util</Package>
    <ClassName>MRToTezHelper</ClassName>
    <SuperClass></SuperClass>
    <SuperInterfaceList>
        <SuperInterface></SuperInterface>
    </SuperInterfaceList>
    <ClassComment></ClassComment>
    <FieldList>
        <Field>
            <FieldName>LOG</FieldName>
            <FieldType>Log</FieldType>
        </Field>
        <Field>
            <FieldName>JOB_SPLIT_RESOURCE_NAME</FieldName>
            <FieldType>String</FieldType>
        </Field>
        <Field>
            <FieldName>JOB_SPLIT_METAINFO_RESOURCE_NAME</FieldName>
            <FieldType>String</FieldType>
        </Field>
        <Field>
            <FieldName>mrAMParamToTezAMParamMap</FieldName>
            <FieldType>Map</FieldType>
        </Field>
        <Field>
            <FieldName>mrAMParamToTezAMParamMap</FieldName>
            <FieldType>String</FieldType>
        </Field>
        <Field>
            <FieldName>mrMapParamToTezVertexParamMap</FieldName>
            <FieldType>Map</FieldType>
        </Field>
        <Field>
            <FieldName>mrMapParamToTezVertexParamMap</FieldName>
            <FieldType>String</FieldType>
        </Field>
        <Field>
            <FieldName>mrReduceParamToTezVertexParamMap</FieldName>
            <FieldType>Map</FieldType>
        </Field>
        <Field>
            <FieldName>mrReduceParamToTezVertexParamMap</FieldName>
            <FieldType>String</FieldType>
        </Field>
        <Field>
            <FieldName>mrSettingsToRetain</FieldName>
            <FieldType>List</FieldType>
        </Field>
        <Field>
            <FieldName>mrSettingsToRetain</FieldName>
            <FieldType>String</FieldType>
        </Field>
        <Field>
            <FieldName>mrSettingsToRemove</FieldName>
            <FieldType>List</FieldType>
        </Field>
        <Field>
            <FieldName>mrSettingsToRemove</FieldName>
            <FieldType>String</FieldType>
        </Field>
    </FieldList>
    <MethodList>
        <Method>
            <MethodName>MRToTezHelper</MethodName>
            <MethodComment></MethodComment>
            <ReturnType></ReturnType>
            <ParameterList/>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>populateMRToTezParamsMap</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList/>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>mrAMParamToTezAMParamMap;put;[MRJobConfig.MR_AM_VMEM_MB, TezConfiguration.TEZ_AM_RESOURCE_MEMORY_MB]</InnerMethodInvoke>
                <InnerMethodInvoke>mrAMParamToTezAMParamMap;put;[MRJobConfig.MR_AM_CPU_VCORES, TezConfiguration.TEZ_AM_RESOURCE_CPU_VCORES]</InnerMethodInvoke>
                <InnerMethodInvoke>mrAMParamToTezAMParamMap;put;[MRJobConfig.MR_AM_MAX_ATTEMPTS, TezConfiguration.TEZ_AM_MAX_APP_ATTEMPTS]</InnerMethodInvoke>
                <InnerMethodInvoke>mrAMParamToTezAMParamMap;put;[MRConfiguration.JOB_CREDENTIALS_BINARY, TezConfiguration.TEZ_CREDENTIALS_PATH]</InnerMethodInvoke>
                <InnerMethodInvoke>mrAMParamToTezAMParamMap;put;[MRJobConfig.JOB_CANCEL_DELEGATION_TOKEN, TezConfiguration.TEZ_CANCEL_DELEGATION_TOKENS_ON_COMPLETION]</InnerMethodInvoke>
                <InnerMethodInvoke>mrMapParamToTezVertexParamMap;put;[MRJobConfig.MAP_MAX_ATTEMPTS, TezConfiguration.TEZ_AM_TASK_MAX_FAILED_ATTEMPTS]</InnerMethodInvoke>
                <InnerMethodInvoke>mrMapParamToTezVertexParamMap;put;[MRJobConfig.MAP_SPECULATIVE, TezConfiguration.TEZ_AM_SPECULATION_ENABLED]</InnerMethodInvoke>
                <InnerMethodInvoke>mrMapParamToTezVertexParamMap;put;[MRJobConfig.MAP_LOG_LEVEL, TezConfiguration.TEZ_TASK_LOG_LEVEL]</InnerMethodInvoke>
                <InnerMethodInvoke>mrMapParamToTezVertexParamMap;put;["mapreduce.job.running.map.limit", "tez.am.vertex.max-task-concurrency"]</InnerMethodInvoke>
                <InnerMethodInvoke>mrMapParamToTezVertexParamMap;put;[MRJobConfig.TASK_TIMEOUT, "tez.am.progress.stuck.interval-ms"]</InnerMethodInvoke>
                <InnerMethodInvoke>mrMapParamToTezVertexParamMap;put;[MRJobConfig.MAP_FAILURES_MAX_PERCENT, "tez.vertex.failures.maxpercent"]</InnerMethodInvoke>
                <InnerMethodInvoke>mrReduceParamToTezVertexParamMap;put;[MRJobConfig.REDUCE_MAX_ATTEMPTS, TezConfiguration.TEZ_AM_TASK_MAX_FAILED_ATTEMPTS]</InnerMethodInvoke>
                <InnerMethodInvoke>mrReduceParamToTezVertexParamMap;put;[MRJobConfig.REDUCE_SPECULATIVE, TezConfiguration.TEZ_AM_SPECULATION_ENABLED]</InnerMethodInvoke>
                <InnerMethodInvoke>mrReduceParamToTezVertexParamMap;put;[MRJobConfig.REDUCE_LOG_LEVEL, TezConfiguration.TEZ_TASK_LOG_LEVEL]</InnerMethodInvoke>
                <InnerMethodInvoke>mrReduceParamToTezVertexParamMap;put;["mapreduce.job.running.reduce.limit", "tez.am.vertex.max-task-concurrency"]</InnerMethodInvoke>
                <InnerMethodInvoke>mrReduceParamToTezVertexParamMap;put;[MRJobConfig.TASK_TIMEOUT, "tez.am.progress.stuck.interval-ms"]</InnerMethodInvoke>
                <InnerMethodInvoke>mrReduceParamToTezVertexParamMap;put;[MRJobConfig.REDUCE_FAILURES_MAXPERCENT, "tez.vertex.failures.maxpercent"]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>populateMRSettingsToRetain</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList/>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>mrSettingsToRetain;add;[FileInputFormat.INPUT_DIR]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRetain;add;[FileInputFormat.SPLIT_MAXSIZE]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRetain;add;[FileInputFormat.SPLIT_MINSIZE]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRetain;add;[FileInputFormat.PATHFILTER_CLASS]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRetain;add;[FileInputFormat.NUM_INPUT_FILES]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRetain;add;[FileInputFormat.INPUT_DIR_RECURSIVE]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRetain;add;[MRConfiguration.OUTPUT_BASENAME]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRetain;add;[FileOutputFormat.COMPRESS]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRetain;add;[FileOutputFormat.COMPRESS_CODEC]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRetain;add;[FileOutputFormat.COMPRESS_TYPE]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRetain;add;[FileOutputFormat.OUTDIR]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRetain;add;[FileOutputCommitter.SUCCESSFUL_JOB_OUTPUT_DIR_MARKER]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>populateMRSettingsToRemove</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList/>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>mrSettingsToRemove;add;[MRJobConfig.MAPREDUCE_JOB_CREDENTIALS_BINARY]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRemove;add;[MRJobConfig.CACHE_ARCHIVES]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRemove;add;[MRJobConfig.CACHE_ARCHIVES_SIZES]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRemove;add;[MRJobConfig.CACHE_ARCHIVES_TIMESTAMPS]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRemove;add;[MRJobConfig.CACHE_ARCHIVES_VISIBILITIES]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRemove;add;[MRJobConfig.CACHE_FILES]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRemove;add;[MRJobConfig.CACHE_FILES_SIZES]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRemove;add;[MRJobConfig.CACHE_FILE_TIMESTAMPS]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRemove;add;[MRJobConfig.CACHE_FILE_VISIBILITIES]</InnerMethodInvoke>
                <InnerMethodInvoke>mrSettingsToRemove;add;[MRJobConfig.CLASSPATH_FILES]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>removeUnwantedSettings</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>tezConf</ParamName>
                    <ParamType>Configuration</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>isAMConf</ParamName>
                    <ParamType>boolean</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar>Iterator&lt;Entry&lt;String,String&gt;&gt; [iter=new Configuration(tezConf).iterator()]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>translateMRSettingsForTezAM</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>dagAMConf</ParamName>
                    <ParamType>TezConfiguration</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar>String [env=dagAMConf.get(MRJobConfig.MR_AM_ADMIN_USER_ENV)]</InnerVar>
                <InnerVar>String [queueName=dagAMConf.get(JobContext.QUEUE_NAME,YarnConfiguration.DEFAULT_QUEUE_NAME)]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>null;convertMRToTezConf;[dagAMConf, dagAMConf, DeprecatedKeys.getMRToDAGParamMap()]</InnerMethodInvoke>
                <InnerMethodInvoke>null;convertMRToTezConf;[dagAMConf, dagAMConf, mrAMParamToTezAMParamMap]</InnerMethodInvoke>
                <InnerMethodInvoke>dagAMConf;setIfUnset;[TezConfiguration.TEZ_AM_LAUNCH_CMD_OPTS, org.apache.tez.mapreduce.hadoop.MRHelpers.getJavaOptsForMRAM(dagAMConf)]</InnerMethodInvoke>
                <InnerMethodInvoke>dagAMConf;setIfUnset;[TezConfiguration.TEZ_QUEUE_NAME, queueName]</InnerMethodInvoke>
                <InnerMethodInvoke>dagAMConf;setIfUnset;[TezConfiguration.TEZ_AM_VIEW_ACLS, dagAMConf.get(MRJobConfig.JOB_ACL_VIEW_JOB,MRJobConfig.DEFAULT_JOB_ACL_VIEW_JOB)]</InnerMethodInvoke>
                <InnerMethodInvoke>dagAMConf;setIfUnset;[TezConfiguration.TEZ_AM_MODIFY_ACLS, dagAMConf.get(MRJobConfig.JOB_ACL_MODIFY_JOB,MRJobConfig.DEFAULT_JOB_ACL_MODIFY_JOB)]</InnerMethodInvoke>
                <InnerMethodInvoke>dagAMConf;setIfUnset;[TezConfiguration.TEZ_TASK_SCALE_MEMORY_RESERVE_FRACTION, "0.5"]</InnerMethodInvoke>
                <InnerMethodInvoke>null;removeUnwantedSettings;[dagAMConf, true]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>setVertexConfig</MethodName>
            <MethodComment>/** 
 * Set config with Scope.Vertex in TezConfiguration on the vertex
 * @param vertex Vertex on which config is to be set
 * @param isMapVertex Whether map or reduce vertex. i.e root or intermediate/leaf vertex
 * @param conf Config that contains the tez or equivalent mapreduce settings.
 */
</MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>vertex</ParamName>
                    <ParamType>Vertex</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>isMapVertex</ParamName>
                    <ParamType>boolean</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>conf</ParamName>
                    <ParamType>Configuration</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar>Map&lt;String,String&gt; [configMapping=isMapVertex ? mrMapParamToTezVertexParamMap : mrReduceParamToTezVertexParamMap]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>processMRSettings</MethodName>
            <MethodComment>/** 
 * Process the mapreduce configuration settings and - copy as is the still required ones (like those used by FileInputFormat/FileOutputFormat) - convert and set equivalent tez runtime settings - handle compression related settings
 * @param tezConf Configuration on which the mapreduce settings will have to be transferred
 * @param mrConf Configuration that contains mapreduce settings
 */
</MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>tezConf</ParamName>
                    <ParamType>Configuration</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>mrConf</ParamName>
                    <ParamType>Configuration</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar>String [slowStartFraction=mrConf.get(MRJobConfig.COMPLETED_MAPS_FOR_REDUCE_SLOWSTART)]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>JobControlCompiler;configureCompression;[tezConf]</InnerMethodInvoke>
                <InnerMethodInvoke>null;convertMRToTezConf;[tezConf, mrConf, DeprecatedKeys.getMRToTezRuntimeParamMap()]</InnerMethodInvoke>
                <InnerMethodInvoke>null;removeUnwantedSettings;[tezConf, false]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>convertMRToTezConf</MethodName>
            <MethodComment>/** 
 * Convert MR settings to Tez settings and set on conf.
 * @param tezConf  Configuration on which MR equivalent Tez settings should be set
 * @param mrConf Configuration that contains MR settings
 * @param mrToTezConfigMapping  Mapping of MR config to equivalent Tez config
 */
</MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>tezConf</ParamName>
                    <ParamType>Configuration</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>mrConf</ParamName>
                    <ParamType>Configuration</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>mrToTezConfigMapping</ParamName>
                    <ParamType>String</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>writeInputSplitInfoToDisk</MethodName>
            <MethodComment>/** 
 * Write input splits (job.split and job.splitmetainfo) to disk
 */
</MethodComment>
            <ReturnType>InputSplitInfoDisk</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>infoMem</ParamName>
                    <ParamType>InputSplitInfoMem</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>inputSplitsDir</ParamName>
                    <ParamType>Path</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>jobConf</ParamName>
                    <ParamType>JobConf</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>fs</ParamName>
                    <ParamType>FileSystem</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar>InputSplit[] [splits=infoMem.getNewFormatSplits()]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>JobSplitWriter;createSplitFiles;[inputSplitsDir, jobConf, fs, splits]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>IOException</ExceptionType>
                <ExceptionType>InterruptedException</ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>updateLocalResourcesForInputSplits</MethodName>
            <MethodComment>/** 
 * Exact copy of private method from from org.apache.tez.mapreduce.hadoop.MRInputHelpers Update provided localResources collection with the required local resources needed by MapReduce tasks with respect to Input splits.
 * @param fs Filesystem instance to access status of splits related files
 * @param inputSplitInfo Information on location of split files
 * @param localResources LocalResources collection to be updated
 * @throws IOException
 */
</MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>fs</ParamName>
                    <ParamType>FileSystem</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>inputSplitInfo</ParamName>
                    <ParamType>InputSplitInfo</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>localResources</ParamName>
                    <ParamType>String</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar>FileStatus [splitFileStatus=fs.getFileStatus(inputSplitInfo.getSplitsFile())]</InnerVar>
                <InnerVar>FileStatus [metaInfoFileStatus=fs.getFileStatus(inputSplitInfo.getSplitsMetaInfoFile())]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>localResources;put;[JOB_SPLIT_RESOURCE_NAME, LocalResource.newInstance(ConverterUtils.getYarnUrlFromPath(inputSplitInfo.getSplitsFile()),LocalResourceType.FILE,LocalResourceVisibility.APPLICATION,splitFileStatus.getLen(),splitFileStatus.getModificationTime())]</InnerMethodInvoke>
                <InnerMethodInvoke>localResources;put;[JOB_SPLIT_METAINFO_RESOURCE_NAME, LocalResource.newInstance(ConverterUtils.getYarnUrlFromPath(inputSplitInfo.getSplitsMetaInfoFile()),LocalResourceType.FILE,LocalResourceVisibility.APPLICATION,metaInfoFileStatus.getLen(),metaInfoFileStatus.getModificationTime())]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>IOException</ExceptionType>
            </ThrowExceptionList>
        </Method>
    </MethodList>
</Class>
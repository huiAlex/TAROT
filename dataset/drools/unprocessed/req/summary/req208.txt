Refactor WorkingMemory  so all entry points use the same code

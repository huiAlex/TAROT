<Class>
    <Id>665</Id>
    <Package>org.drools.persistence.jpa</Package>
    <ClassName>AbstractPersistenceContextManager</ClassName>
    <SuperClass></SuperClass>
    <SuperInterfaceList>
        <SuperInterface></SuperInterface>
    </SuperInterfaceList>
    <ClassComment>AbstractPersistenceContextManager  /** 
 * This class manages  {@link JpaPersistenceContext} objects, and the underlying persistence context ({@link EntityManager})  instances for a persistent  {@link KieSession} and other infrastructure classes that use persistence in KIE projects.&lt;/p&gt; (For reference in the following documentation: the  {@link EntityManager} is the class used to represent a persistence context)&lt;/p&gt; There are 2 issues to take into account when looking at or modifying the code here: &lt;ol&gt; &lt;li&gt;One of the features made available here is the ability for the user to supply their own (Command Scoped) persistence  context for use by the  {@link KieSession}&lt;/li&gt; &lt;li&gt;However, significant race-conditions arise when a Command Scoped persistence context is used in one persistent {@link KieSession} by multiple threads. In other words, when multiple threads call operations on a Singleton persistent {@link KieSession}.&lt;/li&gt; &lt;/ol&gt; This class uses  {@link ThreadLocal} instances for two things:&lt;ol&gt;&lt;li&gt;The internal Command Scoped  {@link EntityManager} instance.&lt;/li&gt;&lt;li&gt;&lt;/li&gt; &lt;/ol&gt;
 */
</ClassComment>
    <FieldList>
        <Field>
            <FieldName>env</FieldName>
            <FieldType>Environment</FieldType>
        </Field>
        <Field>
            <FieldName>emf</FieldName>
            <FieldType>EntityManagerFactory</FieldType>
        </Field>
        <Field>
            <FieldName>txm</FieldName>
            <FieldType>TransactionManager</FieldType>
        </Field>
        <Field>
            <FieldName>appScopedEntityManager</FieldName>
            <FieldType>EntityManager</FieldType>
        </Field>
        <Field>
            <FieldName>cmdScopedEntityManager</FieldName>
            <FieldType>EntityManager</FieldType>
        </Field>
        <Field>
            <FieldName>internalAppScopedEntityManagerFlag</FieldName>
            <FieldType>boolean</FieldType>
        </Field>
        <Field>
            <FieldName>internalCmdScopedEntityManagerFlag</FieldName>
            <FieldType>boolean</FieldType>
        </Field>
    </FieldList>
    <MethodList>
        <Method>
            <MethodName>AbstractPersistenceContextManager</MethodName>
            <MethodComment></MethodComment>
            <ReturnType></ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>env</ParamName>
                    <ParamType>Environment</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getApplicationScopedEntityManager</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>EntityManager</ReturnType>
            <ParameterList/>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getCommandScopedEntityManager</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>EntityManager</ReturnType>
            <ParameterList/>
            <InnerVarList>
                <InnerVar>EntityManager [cmdScopedEntityManager=getInternalCommandScopedEntityManager()]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>cmdScopedEntityManager;joinTransaction;[]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>endCommandScopedEntityManager</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList/>
            <InnerVarList>
                <InnerVar>EntityManager [cmdScopedEntityManager=getInternalCommandScopedEntityManager()]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>dispose</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList/>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getInternalCommandScopedEntityManager</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>EntityManager</ReturnType>
            <ParameterList/>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
    </MethodList>
</Class>
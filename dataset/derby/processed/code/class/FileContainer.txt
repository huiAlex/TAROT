file format integ store format id page cach cach data factori page size spare space minimum record size initi page updat pre alloc threshold pre alloc size bulk increas size alloc page number alloc page offset version estim row count log instant reusabl record sequenc number insert page insert page index unfil page alloc page estim page count pre dirti dirti alloc cach info checksum encrypt buffer saniti manag space trace null type format file factori space info handl set ident key set ident ident creat ident key creat paramet creat ident ident creat paramet clear ident dirti pre dirti pre dirti set dirti dirti creat ident open ident close drop instant drop bump version instant version properti prop read header epag init header chang read header array write header ident page data write header ident file creat epag write offset file byte offset embryon page file data embryon page file offset write header array log creat info creat info log byte array creat info prop creat arg updat dealloc page handl page dealloc pagenum handl pnum compress ntt alloc handl reusabl record sequenc number increment reusabl record sequenc number page user handl ntt alloc handl overflow clear prealloc threshold prepar bulk load handl num page page valid handl pagenum page number handl find alloc page add alloc handl ntt alloc page find alloc page handl tran alloc page ntt handl page number page offset info size init page allochandl pkey creat arg page offset reus overflow user page handl page number overflow wait track unfil page pagenumb unfil page handl page number wait ani page handl page number creat page redo recoveri handl page format page number page offset alloc page page number head page handl page number wait head page handl wait head page handl page number wait insert page handl page number wait overflow page compress handl flag pageno page insert handl flag latch page handl page number unfil page number handl pagenum estim row count flag set estim row count count flag updat estim row count delta estim page count handl flag read page page number page data write page page number page data sync page decrypt page page data page size encrypt page page data page size encrypt buffer engin encrypt buffer pre alloc prealloc pagenum pre alloc size pre alloc page prealloc pagenum pre alloc size page size spare space minimum record size switch multi insert page mode handl insert page unfil page initi insert page size set insert page val set unfil page val handl latch page handl page wait backup handl backup locat context servic servic modul servic modul factori interfac return format identifi inform space open return valid object success open null doe exist standard problem open cacheabl set ident open open key ident set ident caus method resolut ambigu standard problem open cacheabl set ident treat dirti file open cacheabl dirti creat creat refer ident pass ident object ident method return standard derbi standard error polici open longer descrption routin open open file map file doe exist assum creat file exist troubl open throw singl thread requir enforc cach manag standard standard polici drop transact drop increment version return version caller synchron sync block modifi header request system properti associ request valu properti associ follow properti request derbi storag page size derbi storag page reserv space derbi storag minimum record size derbi storag reusabl record derbi storag initi page valu properti add properti list return valu properti set current valu exampl prop conglomer control properti prop properti prop put derbi storag page size properti prop system println tabl page size prop properti derbi storag page size param prop properti list fill standard standard polici read header method call embryon page pass read direct file input stream alloc page cach becaus stubbifi oper onli write stub disk doe rid ani stale page page cach happen stubbifi object age cach alloc page hasn ani stale page written reopen routin call alloc page cach becaus stale page drop singl thread requir enforc caller param epag embryon page read header standard derbi standard error polici error read header file read info byte array header array written format put togeth write header array standard derbi standard error polici error read header file write header page array alloc page standard derbi standard error polici error write header file write header direct file subclass write header expect manufactur data output stream singl thread requir enforc caller standard derbi standard error polici error write header file write sequenc byte offset file method thread safe caller thread perform oper chang current posit file param file file write param byte byte write param offset offset start write throw error occur write standard derbi standard error polici embryon page data input stream embryon page read input stream file data assum posit alloc page error read embryon page file standard derbi standard error polici read embryon page section alloc page larg borrow space includ specifi offset code storag random access file method thread safe caller thread perform oper chang current posit file param file file read param offset start read normal code file return byte array embryon page throw error occur read throw standard derbi standard error polici write info byte array header put togeth read read header array error write header log inform creation necessari recreat dure load tran standard derbi standard error polici set properti pass byte array creat log creat info inform recreat dure recoveri load tran follow properti set page size spare space minimum record size reusabl record initi page set properti pass creat arg follow properti set page size spare space minimum record size reusabl record initi page futur set paramet overrid class implement requir minimum page size dealloc page param handl handl dealloc param page page dealloc latch entri unlatch caller function standard derbi standard error polici dealloc page alloc page compress free space thread awar assum caller super class alreadi arrang logic lock page alloc onli singl thread compress free space alloc page unit work loop oper alloc page free space page involv transact updat alloc page data page possibl delet alloc page user transact initi compress call nest top transact transact start raw store insid compress call commit befor compress return access high traffic data structur alloc page outlin algorithm compress free page loop loop return space occupi free page includ alloc page page free find alloc page onli invalid alloc inform cach cach page page alreadi page cach affect latch alloc page invalid alloc cach block page commit alloc page determin page releas mark data structur alloc extent mark contigu block nalloc free page file unalloc chang associ call dealloc space file note system handl boot alloc page file extend file automat free space alloc page alloc page free alloc page requir updat previous alloc page loop latch alloc page delet restart loop latch releas befor routin return caller commit releas alloc page latch don alloc page latch releas routin return param ntt nest top transact purpos free space ntt null user transact alloc param alloc handl handl open ntt latch alloc page standard standard derbi error polici reusabl record sequenc number base reusabl record sequenc number return reusabl record sequenc number increment reusabl record version sequenc number creat page thread awar assum caller super class alreadi arrang logic lock page alloc onli singl thread ad page involv transact page user transact initi add page call expect latch page return nest top transact transact start raw store insid add page call commit befor page return access high traffic data structur alloc page outlin algorithm ad page find alloc page handl add page latch alloc page invalid alloc inform cach cach page page alreadi page cach affect latch alloc page invalid alloc cach block page commit alloc page determin page alloc mark data structur alloc extent return page number page chang associ creat page page cach bypass lookup alloc page sinc alreadi latch deadlock initi page mark page page latch transfer page return latch caller commit releas alloc page latch don alloc page latch releas routin return param user handl handl open user transact latch user page param ntt nest top transact purpos alloc page ntt null user transact alloc param alloc handl handl open ntt latch alloc page standard standard derbi error polici find alloc page return null alloc page initi page return latch page initi param allochandl contian handl initi page ntt param pkey page number page initi param creat arg argument page creation param reus true reus page alreadi initi onc standard derbi standard error polici page user page generic base routin user client raw store page routin coordin alloc dealloc ensur page page middl alloc dealloc routin latch page param handl handl param page number page number page param overflow true overflow page fals onli overflow page param wait true wait latch return latch page thread safe standard standard derbi error polici valid dealloc free page overflow page result page latch thread safe standard standard derbi error polici ani page turn valid standard derbi standard error polici creat page rollforward recoveri dure redo recoveri possibl system tri redo creation page exist version trys read page disk differ type error occur page doe exist disk happen dure rollforward recoveri appli backup file copi page ad file dure time frame backup physic file copi space file exist init happen happen crash moment dure alloc process possibl read part file written result garbag store point view result error easi recov system easili creat version scratch write disk becaus system doe sync alloc data page possibl point whlie write version disk creat encount disk space error caught routin standard creat call recoveri outsid caught nest thrown recoveri system output user check disk space error standard standard polici alloc page onli access raw store recoveri standard derbi standard error polici onli valid overflow page page number invalid overflow return null standard derbi standard error polici valid page standard derbi standard error polici page standard standard derbi error polici candid page move row compress tabl caller move row tabl goal free block empti page return entri pageno latch caller onli return page number pageno attempt return pageno result latch latch deadlock thread standard standard polici potenti suitabl page insert latch standard standard derbi error polici latch page incas backup page latch necessari prevent modif page written backup backup process reli latch consist snap shot page user level tabl page row lock acquir onlin backup mechan param handl handl latch page param page number page number page return latch page standard standard derbi error polici routin safe client don provid synchron handl estim row count handl set estim row count updat estim row count page leav cach estim row count updat log handl estim page count standard standard derbi error polici read page suppli array thread safe error read page standard standard derbi error messag write page suppli array thread safe error write page standard standard derbi error polici decrypt page safe standard standard derbi error polici encrypt page safe call synchron block onli return byte array synchron block standard standard derbi error polici encrypt buffer safe call synchron block onli return byte array synchron block return byte array encryp page pre alloc write prealloc page disk necessari larg page format onli reason save dure page initi onc init page log record written expect page realli exist form recoveri fail howev gain perform write bunch page time time doesn sens implement pre alloc return log don actual anyth return return number success prealloc page page prealloc param prealloc pagenum prealloc page number alloc page param pre alloc size tri prealloc page number page sinc onli mani page actual disk determin number page alloc page prealloc alreadi alloc case act prealloc success prealloc page actual call subclass onli find file open backup param handl handl param backup locat locat backup standard standard derbi error polici privileg lookup context servic limit packag visibl user code call entri point privileg modul lookup privat user code call entri point file abstract base class base file class extend base implement cacheabl type format 
lock control ref grant grant wait possibl skip lock control lock ref lock control copi lock control empti grant lock item unlock lock group unlock count grantabl waiter befor compat space qualifi add lock compat space qualifi unlock waiter waiter item remov lockabl grant grant wait give wait item add waiter waiter grant lock compat space qualifi block parent child lock shallow clone add waiter lock item pop front waiter remov waiter index remov waiter item grant lock routin call lock current wait list grant lock waiter jump waiter grant avoid waiter starv add lock control grant possibl enter sever state lockabl lock grant queue empti waiter wait queue empti lockabl lock waiter lockabl lock waiter potenti grant lockabl unlock waiter potenti grant logic item lock lock releas waker woken call enter object unlock waiter lockabl unlock return lock wait line null line empti wait lock ani return lockabl object control give wait lock add waiter lock map object wait thread entri hashtabl key compat space valu activ lock key activ lock valu lock control waiter| activ lock previosu waiter return stack held lock lock object lockabl find grant lock match space qualifi return true child lock block becaus parent confict lock code written support fix onli condit aris write attempt nest user transact block read lock held main transact onli happen tri write manag sequenc generat shallow clone add lock request list waiter param lock item lock request param lock tabl remov return lock request list waiter param lock tabl return remov lock request remov return lock request index list waiter param index index remov lock request param lock tabl return remov lock request remov return lock request list waiter param item item remov param lock tabl return number item remov lock control refer item lock doubli link list grant lock wait lock mutabl object singl thread requir 
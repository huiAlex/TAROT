prevent deadlock lock access public prevent deadlock transact sort key befor call method acquir lock cach put cach remov exampl don lock stripe lock key follow case creat deadlock thread doe acquir lock cach put acquir lock cach put acquir lock relea commit thread doe acquir lock cach put acquir lock cach put acquir lock relea commit prevent deadlock simpli sort key lock acquisit order unfortun lock stripe sort key face deadlock becaus predict lock distribut key exampl follow test case creat deadlock lock stripe enabl public class test deadlock extend test case unpredict deadlock becaus implement reentrant stripe lock key map lock map lock differ case key sort deadlock public void test lock stripe true unpredict dead lock throw default cach manag manag default cach manag manag default configur set invoc batch enabl true manag default configur set lock acquisit timeout final cach string string cach manag cach final count latch start signal count latch final count latch signal count latch final atom refer atom refer thread java lang thread run overrid public void run tri cach start batch start signal await cach put aaaaaaaa valu cach put aaaaaaaaaaaaaa valu cach batch true catch set final signal count start thread java lang thread run overrid public void run tri cach start batch start signal await cach put aaaaaaaaaaa valu cach put aaaaaaaaaaaaa valu cach batch true catch set final signal count start start signal count signal await assert null lock public sort key accord valu avoid deadlock lock stripe enabl 
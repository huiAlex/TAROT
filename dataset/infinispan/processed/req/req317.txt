default cach manag cach block newli creat cach start current default cach manag store cach concurr map call cach cach doe exist cach creat put map put absent cach start consequ subsequ concurr thread call cach cach cach readi lead unexpect behavior ideal call cach block request cach newli creat start request alreadi start cach block possibl implement involv store cach side volatil singl thread gate count latch concurr map algorithm lookup map entri cach gate cach map entri exist gate present return cach map entri exist latch present wait latch ideal timeout return cach map entri doe exist creat cach put map absent thread gate put success entri alreadi exist goto start cach start fail stop cach remov map entri thread wait gate timeout open gate remov gate map entri return cach horrid generic version abov sourc code exampl demonstr registri map registri store factori 
<Class>
    <Id>351</Id>
    <Package>org.infinispan.transaction.xa.recovery</Package>
    <ClassName>RecoveryManagerImpl</ClassName>
    <SuperClass></SuperClass>
    <SuperInterfaceList>
        <SuperInterface>RecoveryManager</SuperInterface>
    </SuperInterfaceList>
    <ClassComment>RecoveryManagerImpl  /** 
 * Default implementation for  {@link RecoveryManager}
 * @author Mircea.Markus@jboss.com
 * @since 5.0
 */
</ClassComment>
    <FieldList>
        <Field>
            <FieldName>log</FieldName>
            <FieldType>Log</FieldType>
        </Field>
        <Field>
            <FieldName>trace</FieldName>
            <FieldType>boolean</FieldType>
        </Field>
        <Field>
            <FieldName>rpcManager</FieldName>
            <FieldType>RpcManager</FieldType>
        </Field>
        <Field>
            <FieldName>commandFactory</FieldName>
            <FieldType>CommandsFactory</FieldType>
        </Field>
        <Field>
            <FieldName>inDoubtTransactions</FieldName>
            <FieldType>ConcurrentMap</FieldType>
        </Field>
        <Field>
            <FieldName>inDoubtTransactions</FieldName>
            <FieldType>RecoveryInfoKey</FieldType>
        </Field>
        <Field>
            <FieldName>cacheName</FieldName>
            <FieldType>String</FieldType>
        </Field>
        <Field>
            <FieldName>txTable</FieldName>
            <FieldType>RecoveryAwareTransactionTable</FieldType>
        </Field>
        <Field>
            <FieldName>txCoordinator</FieldName>
            <FieldType>TransactionCoordinator</FieldType>
        </Field>
        <Field>
            <FieldName>txFactory</FieldName>
            <FieldType>TransactionFactory</FieldType>
        </Field>
        <Field>
            <FieldName>broadcastForPreparedTx</FieldName>
            <FieldType>boolean</FieldType>
        </Field>
    </FieldList>
    <MethodList>
        <Method>
            <MethodName>RecoveryManagerImpl</MethodName>
            <MethodComment></MethodComment>
            <ReturnType></ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>recoveryHolder</ParamName>
                    <ParamType>RecoveryInfoKey</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>cacheName</ParamName>
                    <ParamType>String</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>init</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>rpcManager</ParamName>
                    <ParamType>RpcManager</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>commandsFactory</ParamName>
                    <ParamType>CommandsFactory</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>txTable</ParamName>
                    <ParamType>TransactionTable</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>txCoordinator</ParamName>
                    <ParamType>TransactionCoordinator</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>txFactory</ParamName>
                    <ParamType>TransactionFactory</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getPreparedTransactionsFromCluster</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>RecoveryIterator</ReturnType>
            <ParameterList/>
            <InnerVarList>
                <InnerVar>PreparedTxIterator [iterator=new PreparedTxIterator()]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>iterator;add;[txTable.getLocalPreparedXids()]</InnerMethodInvoke>
                <InnerMethodInvoke>iterator;add;[getInDoubtTransactions()]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>removeRecoveryInformation</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>lockOwners</ParamName>
                    <ParamType>Address</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>xid</ParamName>
                    <ParamType>Xid</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>sync</ParamName>
                    <ParamType>boolean</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>gtx</ParamName>
                    <ParamType>GlobalTransaction</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>fromCluster</ParamName>
                    <ParamType>boolean</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>log;tracef;["Forgetting tx information for %s", gtx]</InnerMethodInvoke>
                <InnerMethodInvoke>null;removeRecoveryInformation;[xid]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>removeRecoveryInformationFromCluster</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>where</ParamName>
                    <ParamType>Address</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>internalId</ParamName>
                    <ParamType>long</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>sync</ParamName>
                    <ParamType>boolean</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>null;removeRecoveryInformation;[internalId]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>removeRecoveryInformation</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>RecoveryAwareTransaction</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>xid</ParamName>
                    <ParamType>Xid</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar>RecoveryAwareTransaction [remove=inDoubtTransactions.remove(new RecoveryInfoKey(xid,cacheName))]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>log;tracef;["removed in doubt xid: %s", xid]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>removeRecoveryInformation</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>RecoveryAwareTransaction</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>internalId</ParamName>
                    <ParamType>Long</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar>Xid [remoteTransactionXid=txTable.getRemoteTransactionXid(internalId)]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>log;tracef;["Could not find tx to map to internal id %s", internalId]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getInDoubtTransactions</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>Xid</ReturnType>
            <ParameterList/>
            <InnerVarList>
                <InnerVar>List&lt;Xid&gt; [result=new ArrayList&lt;Xid&gt;()]</InnerVar>
                <InnerVar>Set&lt;RecoveryInfoKey&gt; [recoveryInfoKeys=inDoubtTransactions.keySet()]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>log;tracef;["Returning %s ", result]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getInDoubtTransactionInfo</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>InDoubtTxInfo</ReturnType>
            <ParameterList/>
            <InnerVarList>
                <InnerVar>List&lt;Xid&gt; [txs=getInDoubtTransactions()]</InnerVar>
                <InnerVar>Set&lt;RecoveryAwareLocalTransaction&gt; [localTxs=txTable.getLocalTxThatFailedToComplete()]</InnerVar>
                <InnerVar>Set&lt;InDoubtTxInfo&gt; [result=new HashSet&lt;InDoubtTxInfo&gt;()]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>log;tracef;["Local transactions that failed to complete is %s", localTxs]</InnerMethodInvoke>
                <InnerMethodInvoke>log;tracef;["The set of in-doubt txs from this node is %s", result]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getInDoubtTransactionInfoFromCluster</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>InDoubtTxInfo</ReturnType>
            <ParameterList/>
            <InnerVarList>
                <InnerVar>Map&lt;Xid,InDoubtTxInfoImpl&gt; [result=new HashMap&lt;Xid,InDoubtTxInfoImpl&gt;()]</InnerVar>
                <InnerVar>Set&lt;InDoubtTxInfo&gt; [onThisNode=getInDoubtTransactionInfo()]</InnerVar>
                <InnerVar>Iterator&lt;InDoubtTxInfo&gt; [iterator=onThisNode.iterator()]</InnerVar>
                <InnerVar>HashSet&lt;InDoubtTxInfo&gt; [value=new HashSet&lt;InDoubtTxInfo&gt;(result.values())]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>value;addAll;[onThisNode]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>registerInDoubtTransaction</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>remoteTransaction</ParamName>
                    <ParamType>RecoveryAwareRemoteTransaction</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar>Xid [xid=((RecoverableTransactionIdentifier)remoteTransaction.getGlobalTransaction()).getXid()]</InnerVar>
                <InnerVar>RecoveryAwareTransaction [previous=inDoubtTransactions.put(new RecoveryInfoKey(xid,cacheName),remoteTransaction)]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getPreparedTransaction</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>RecoveryAwareRemoteTransaction</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>xid</ParamName>
                    <ParamType>Xid</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>forceTransactionCompletion</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>String</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>xid</ParamName>
                    <ParamType>Xid</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>commit</ParamName>
                    <ParamType>boolean</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar>LocalXaTransaction [localTransaction=txTable.getLocalTransaction(xid)]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>completeTransaction</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>String</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>localTx</ParamName>
                    <ParamType>LocalTransaction</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>commit</ParamName>
                    <ParamType>boolean</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>xid</ParamName>
                    <ParamType>Xid</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>null;removeRecoveryInformation;[null, xid, false, localTx.getGlobalTransaction(), false]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>forceTransactionCompletionFromCluster</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>String</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>xid</ParamName>
                    <ParamType>Xid</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>where</ParamName>
                    <ParamType>Address</ParamType>
                </Parameter>
                <Parameter>
                    <ParamName>commit</ParamName>
                    <ParamType>boolean</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar>CompleteTransactionCommand [ctc=commandFactory.buildCompleteTransactionCommand(xid,commit)]</InnerVar>
                <InnerVar>Map&lt;Address,Response&gt; [responseMap=rpcManager.invokeRemotely(Collections.singleton(where),ctc,rpcManager.getDefaultRpcOptions(true))]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>isTransactionPrepared</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>boolean</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>globalTx</ParamName>
                    <ParamType>GlobalTransaction</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar>Xid [xid=((RecoverableTransactionIdentifier)globalTx).getXid()]</InnerVar>
                <InnerVar>RecoveryAwareRemoteTransaction [remoteTransaction=(RecoveryAwareRemoteTransaction)txTable.getRemoteTransaction(globalTx)]</InnerVar>
                <InnerVar>boolean [remotePrepared=remoteTransaction != null &amp;&amp; remoteTransaction.isPrepared()]</InnerVar>
                <InnerVar>boolean [result=inDoubtTransactions.get(new RecoveryInfoKey(xid,cacheName)) != null || txTable.getLocalPreparedXids().contains(xid) || remotePrepared]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>isSuccessful</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>boolean</ReturnType>
            <ParameterList>
                <Parameter>
                    <ParamName>thisResponse</ParamName>
                    <ParamType>Response</ParamType>
                </Parameter>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>notOnlyMeInTheCluster</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>boolean</ReturnType>
            <ParameterList/>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getAllPreparedTxFromCluster</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>Address</ReturnType>
            <ParameterList/>
            <InnerVarList>
                <InnerVar>GetInDoubtTransactionsCommand [command=commandFactory.buildGetInDoubtTransactionsCommand()]</InnerVar>
                <InnerVar>Map&lt;Address,Response&gt; [addressResponseMap=rpcManager.invokeRemotely(null,command,rpcManager.getDefaultRpcOptions(true))]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getInDoubtTransactionsMap</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>RecoveryInfoKey</ReturnType>
            <ParameterList/>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
    </MethodList>
</Class>
This is better than the current segment-based approach, in terms of memory footprint as well as performance under high concurrency.

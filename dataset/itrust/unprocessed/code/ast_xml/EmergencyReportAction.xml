<Class>
    <Id>507</Id>
    <Package>edu.ncsu.csc.itrust.action</Package>
    <ClassName>EmergencyReportAction</ClassName>
    <SuperClass>PatientBaseAction</SuperClass>
    <SuperInterfaceList>
        <SuperInterface></SuperInterface>
    </SuperInterfaceList>
    <ClassComment>EmergencyReportAction  /** 
 * Creates a new Emergency Report Used by emergencyReport.jsp
 * @author laurenhayward
 */
</ClassComment>
    <FieldList>
        <Field>
            <FieldName>patientDAO</FieldName>
            <FieldType>PatientDAO</FieldType>
        </Field>
        <Field>
            <FieldName>allergyDAO</FieldName>
            <FieldType>AllergyDAO</FieldType>
        </Field>
        <Field>
            <FieldName>ovDAO</FieldName>
            <FieldType>OfficeVisitDAO</FieldType>
        </Field>
        <Field>
            <FieldName>pb</FieldName>
            <FieldType>PatientBean</FieldType>
        </Field>
        <Field>
            <FieldName>emailutil</FieldName>
            <FieldType>EmailUtil</FieldType>
        </Field>
    </FieldList>
    <MethodList>
        <Method>
            <MethodName>EmergencyReportAction</MethodName>
            <MethodComment>/** 
 * The super class handles validating the pid Logs viewing of the report
 * @param factory The DAOFactory used in creating the DAOs for this action.
 * @param loggedInMID The MID of the user who is looking at the emergency report.
 * @param pidString The ID of the patient whose report is being generated.
 * @throws iTrustException
 */
</MethodComment>
            <ReturnType></ReturnType>
            <ParameterList>
                <ParameterType>DAOFactory factory</ParameterType>
                <ParameterType>long loggedInMID</ParameterType>
                <ParameterType>String pidString</ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>emailutil;sendEmail;[makeEmail()]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>iTrustException</ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getPatientName</MethodName>
            <MethodComment>/** 
 * Returns the patient's name
 * @return patient's full name
 */
</MethodComment>
            <ReturnType>String</ReturnType>
            <ParameterList>
                <ParameterType></ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getPatientAge</MethodName>
            <MethodComment>/** 
 * Returns the patient's age
 * @return patient's age
 */
</MethodComment>
            <ReturnType>String</ReturnType>
            <ParameterList>
                <ParameterType></ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getPatientGender</MethodName>
            <MethodComment>/** 
 * Returns the patient's gender
 * @return patient's gender
 */
</MethodComment>
            <ReturnType>String</ReturnType>
            <ParameterList>
                <ParameterType></ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getPatientEmergencyContact</MethodName>
            <MethodComment>/** 
 * Returns the patient's emergency contact
 * @return patient's emergency contact
 */
</MethodComment>
            <ReturnType>String</ReturnType>
            <ParameterList>
                <ParameterType></ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getBloodType</MethodName>
            <MethodComment>/** 
 * Returns the patient's blood type
 * @return the patient's blood type
 */
</MethodComment>
            <ReturnType>String</ReturnType>
            <ParameterList>
                <ParameterType></ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType></ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getAllergies</MethodName>
            <MethodComment>/** 
 * Returns a list of allergies for the given patient
 * @return a list of AllergyBeans
 * @throws iTrustException
 */
</MethodComment>
            <ReturnType>AllergyBean</ReturnType>
            <ParameterList>
                <ParameterType></ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>iTrustException</ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getCurrentPrescriptions</MethodName>
            <MethodComment>/** 
 * Returns a list of prescriptions the patient is currently taking
 * @return a list of PrescriptionBeans for which the patient is currently taking
 * @throws iTrustException
 */
</MethodComment>
            <ReturnType>PrescriptionBean</ReturnType>
            <ParameterList>
                <ParameterType></ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar>List&lt;PrescriptionBean&gt; [allPrescriptions=patientDAO.getCurrentPrescriptions(this.pid)]</InnerVar>
                <InnerVar>ArrayList&lt;PrescriptionBean&gt; [warningList=new ArrayList&lt;PrescriptionBean&gt;()]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>iTrustException</ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getWarningDiagnoses</MethodName>
            <MethodComment>/** 
 * Returns a list of diagnoses that are in the range indicated by the DiagnosisRange enum
 * @return list of DiagnosisBeans
 * @throws iTrustException
 */
</MethodComment>
            <ReturnType>DiagnosisBean</ReturnType>
            <ParameterList>
                <ParameterType></ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>iTrustException</ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getImmunizations</MethodName>
            <MethodComment>/** 
 * Returns a list of prescriptions the patient is currently taking
 * @return a list of PrescriptionBeans for which the patient is currently taking
 * @throws iTrustException
 */
</MethodComment>
            <ReturnType>ProcedureBean</ReturnType>
            <ParameterList>
                <ParameterType></ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar>List&lt;ProcedureBean&gt; [allImmunizations=patientDAO.getImmunizationProcedures(this.pid)]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>iTrustException</ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>makeEmail</MethodName>
            <MethodComment>/** 
 * Creates a fake e-mail to notify the user that an emergency report has been created and viewed.
 * @return the e-mail to be sent
 * @throws DBException
 */
</MethodComment>
            <ReturnType>Email</ReturnType>
            <ParameterList>
                <ParameterType></ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar>Email [email=new Email()]</InnerVar>
                <InnerVar>List&lt;PatientBean&gt; [reps=patientDAO.getRepresenting(pb.getMID())]</InnerVar>
                <InnerVar>List&lt;String&gt; [toAddrs=new ArrayList&lt;String&gt;()]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>toAddrs;add;[pb.getEmail()]</InnerMethodInvoke>
                <InnerMethodInvoke>email;setFrom;["no-reply@itrust.com"]</InnerMethodInvoke>
                <InnerMethodInvoke>email;setToList;[toAddrs]</InnerMethodInvoke>
                <InnerMethodInvoke>email;setSubject;[String.format("Emergency Report Viewed Notification")]</InnerMethodInvoke>
                <InnerMethodInvoke>email;setBody;["Dear " + pb.getFullName() + ",\n An emergency report has been generated. "+ "Please login to iTrust to see who has viewed your records."]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>DBException</ExceptionType>
            </ThrowExceptionList>
        </Method>
    </MethodList>
</Class>
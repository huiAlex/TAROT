<Class>
    <Id>488</Id>
    <Package>edu.ncsu.csc.itrust.action</Package>
    <ClassName>EditSingleReferralAction</ClassName>
    <SuperClass></SuperClass>
    <SuperInterfaceList>
        <SuperInterface></SuperInterface>
    </SuperInterfaceList>
    <ClassComment>EditSingleReferralAction  /** 
 * Class that allows creating, editing, and deleting of a single referral.
 * @author student
 */
</ClassComment>
    <FieldList>
        <Field>
            <FieldName>referralDAO</FieldName>
            <FieldType>ReferralDAO</FieldType>
        </Field>
        <Field>
            <FieldName>patientDAO</FieldName>
            <FieldType>PatientDAO</FieldType>
        </Field>
        <Field>
            <FieldName>personnelDAO</FieldName>
            <FieldType>PersonnelDAO</FieldType>
        </Field>
        <Field>
            <FieldName>ovDAO</FieldName>
            <FieldType>OfficeVisitDAO</FieldType>
        </Field>
        <Field>
            <FieldName>messageAction</FieldName>
            <FieldType>SendMessageAction</FieldType>
        </Field>
        <Field>
            <FieldName>hcpid</FieldName>
            <FieldType>long</FieldType>
        </Field>
    </FieldList>
    <MethodList>
        <Method>
            <MethodName>EditSingleReferralAction</MethodName>
            <MethodComment></MethodComment>
            <ReturnType></ReturnType>
            <ParameterList>
                <ParameterType>DAOFactory factory</ParameterType>
                <ParameterType>long hcpid</ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>iTrustException</ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getReferral</MethodName>
            <MethodComment>/** 
 * Get a specific referral.
 * @param id
 * @return
 * @throws DBException
 */
</MethodComment>
            <ReturnType>ReferralBean</ReturnType>
            <ParameterList>
                <ParameterType>long id</ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>DBException</ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>addReferral</MethodName>
            <MethodComment>/** 
 * Add a new referral to the database.
 * @param bean
 * @throws Exception
 */
</MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList>
                <ParameterType>ReferralBean bean</ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar>long [id=referralDAO.addReferral(bean)]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>null;sendReferralCreatedMessages;[bean]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>Exception</ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>editReferral</MethodName>
            <MethodComment>/** 
 * Edit an existing referral.
 * @param bean
 * @throws iTrustException
 */
</MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList>
                <ParameterType>ReferralBean bean</ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>referralDAO;editReferral;[bean]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>iTrustException</ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>deleteReferral</MethodName>
            <MethodComment>/** 
 * Delete a referral from the database.
 * @param bean
 * @throws Exception
 */
</MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList>
                <ParameterType>ReferralBean bean</ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>referralDAO;removeReferral;[bean.getId()]</InnerMethodInvoke>
                <InnerMethodInvoke>null;sendReferralCancelledMessages;[bean]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>Exception</ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getPatientName</MethodName>
            <MethodComment>/** 
 * Get the patient name associated with the given referral.
 * @param bean
 * @return The patient's name as a String.
 * @throws iTrustException
 */
</MethodComment>
            <ReturnType>String</ReturnType>
            <ParameterList>
                <ParameterType>ReferralBean bean</ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>iTrustException</ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getReceivingHCPName</MethodName>
            <MethodComment>/** 
 * Get the name of the receiving HCP associated with the given referral.
 * @param bean
 * @return The HCP's name as a String.
 * @throws iTrustException
 */
</MethodComment>
            <ReturnType>String</ReturnType>
            <ParameterList>
                <ParameterType>ReferralBean bean</ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>iTrustException</ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getReceivingHCPSpecialty</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>String</ReturnType>
            <ParameterList>
                <ParameterType>ReferralBean bean</ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar>String [s=personnelDAO.getPersonnel(bean.getReceiverID()).getSpecialty()]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>iTrustException</ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>getOfficeVisitDate</MethodName>
            <MethodComment></MethodComment>
            <ReturnType>String</ReturnType>
            <ParameterList>
                <ParameterType>ReferralBean bean</ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar></InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke></InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>iTrustException</ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>sendReferralCreatedMessages</MethodName>
            <MethodComment>/** 
 * Send messages to the users associated with creating a referral.
 * @param bean
 * @throws Exception
 */
</MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList>
                <ParameterType>ReferralBean bean</ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar>StringBuilder [body=new StringBuilder()]</InnerVar>
                <InnerVar>String [senderSpecialty=personnelDAO.getPersonnel(bean.getSenderID()).getSpecialty()]</InnerVar>
                <InnerVar>String [receiverSpecialty=personnelDAO.getPersonnel(bean.getReceiverID()).getSpecialty()]</InnerVar>
                <InnerVar>MessageBean [senderMsg=new MessageBean()]</InnerVar>
                <InnerVar>MessageBean [receiverMsg=new MessageBean()]</InnerVar>
                <InnerVar>MessageBean [patientMsg=new MessageBean()]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>body;append;["Referral information:\n"]</InnerMethodInvoke>
                <InnerMethodInvoke>body;append;["Sending HCP: " + personnelDAO.getName(bean.getSenderID()) + " ("+ senderSpecialty+ ")\n"]</InnerMethodInvoke>
                <InnerMethodInvoke>body;append;["Receiving HCP: " + personnelDAO.getName(bean.getReceiverID()) + " ("+ receiverSpecialty+ ")\n"]</InnerMethodInvoke>
                <InnerMethodInvoke>body;append;["Patient: " + getPatientName(bean) + "\n"]</InnerMethodInvoke>
                <InnerMethodInvoke>body;append;["Notes: " + bean.getReferralDetails() + "\n"]</InnerMethodInvoke>
                <InnerMethodInvoke>body;append;["Created on: " + bean.getTimeStamp() + "\n"]</InnerMethodInvoke>
                <InnerMethodInvoke>senderMsg;setFrom;[bean.getSenderID()]</InnerMethodInvoke>
                <InnerMethodInvoke>senderMsg;setTo;[bean.getSenderID()]</InnerMethodInvoke>
                <InnerMethodInvoke>senderMsg;setBody;[body.toString()]</InnerMethodInvoke>
                <InnerMethodInvoke>senderMsg;setSubject;["You Created a New Referral"]</InnerMethodInvoke>
                <InnerMethodInvoke>senderMsg;setRead;[0]</InnerMethodInvoke>
                <InnerMethodInvoke>messageAction;sendMessage;[senderMsg]</InnerMethodInvoke>
                <InnerMethodInvoke>receiverMsg;setFrom;[bean.getSenderID()]</InnerMethodInvoke>
                <InnerMethodInvoke>receiverMsg;setTo;[bean.getReceiverID()]</InnerMethodInvoke>
                <InnerMethodInvoke>receiverMsg;setBody;[body.toString()]</InnerMethodInvoke>
                <InnerMethodInvoke>receiverMsg;setSubject;["You Received a New Referral"]</InnerMethodInvoke>
                <InnerMethodInvoke>receiverMsg;setRead;[0]</InnerMethodInvoke>
                <InnerMethodInvoke>messageAction;sendMessage;[receiverMsg]</InnerMethodInvoke>
                <InnerMethodInvoke>patientMsg;setFrom;[bean.getSenderID()]</InnerMethodInvoke>
                <InnerMethodInvoke>patientMsg;setTo;[bean.getPatientID()]</InnerMethodInvoke>
                <InnerMethodInvoke>patientMsg;setBody;[body.toString()]</InnerMethodInvoke>
                <InnerMethodInvoke>patientMsg;setSubject;["You Received a New Referral"]</InnerMethodInvoke>
                <InnerMethodInvoke>patientMsg;setRead;[0]</InnerMethodInvoke>
                <InnerMethodInvoke>messageAction;sendMessage;[patientMsg]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>Exception</ExceptionType>
            </ThrowExceptionList>
        </Method>
        <Method>
            <MethodName>sendReferralCancelledMessages</MethodName>
            <MethodComment>/** 
 * Send messages to the users associated with canceling a referral.
 * @param bean
 * @throws Exception
 */
</MethodComment>
            <ReturnType>void</ReturnType>
            <ParameterList>
                <ParameterType>ReferralBean bean</ParameterType>
            </ParameterList>
            <InnerVarList>
                <InnerVar>StringBuilder [body=new StringBuilder()]</InnerVar>
                <InnerVar>MessageBean [receiverMsg=new MessageBean()]</InnerVar>
                <InnerVar>MessageBean [patientMsg=new MessageBean()]</InnerVar>
            </InnerVarList>
            <InnerMethodInvokeList>
                <InnerMethodInvoke>body;append;["The referral created on " + bean.getTimeStamp() + "has been deleted.\n\n"]</InnerMethodInvoke>
                <InnerMethodInvoke>body;append;["The referral is reproduced here for your convienence:\n"]</InnerMethodInvoke>
                <InnerMethodInvoke>body;append;["Sending HCP: " + personnelDAO.getName(bean.getSenderID()) + " ("+ personnelDAO.getPersonnel(bean.getSenderID()).getSpecialty()+ ")\n"]</InnerMethodInvoke>
                <InnerMethodInvoke>body;append;["Receiving HCP: " + personnelDAO.getName(bean.getReceiverID()) + " ("+ personnelDAO.getPersonnel(bean.getReceiverID()).getSpecialty()+ ")\n"]</InnerMethodInvoke>
                <InnerMethodInvoke>body;append;["Patient: " + getPatientName(bean) + "\n"]</InnerMethodInvoke>
                <InnerMethodInvoke>body;append;["Notes: " + bean.getReferralDetails() + "\n"]</InnerMethodInvoke>
                <InnerMethodInvoke>body;append;["Created on: " + bean.getTimeStamp() + "\n"]</InnerMethodInvoke>
                <InnerMethodInvoke>receiverMsg;setFrom;[bean.getSenderID()]</InnerMethodInvoke>
                <InnerMethodInvoke>receiverMsg;setTo;[bean.getReceiverID()]</InnerMethodInvoke>
                <InnerMethodInvoke>receiverMsg;setBody;[body.toString()]</InnerMethodInvoke>
                <InnerMethodInvoke>receiverMsg;setSubject;["Your Referral Was Cancelled"]</InnerMethodInvoke>
                <InnerMethodInvoke>receiverMsg;setRead;[0]</InnerMethodInvoke>
                <InnerMethodInvoke>messageAction;sendMessage;[receiverMsg]</InnerMethodInvoke>
                <InnerMethodInvoke>patientMsg;setFrom;[bean.getSenderID()]</InnerMethodInvoke>
                <InnerMethodInvoke>patientMsg;setTo;[bean.getPatientID()]</InnerMethodInvoke>
                <InnerMethodInvoke>patientMsg;setBody;[body.toString()]</InnerMethodInvoke>
                <InnerMethodInvoke>patientMsg;setSubject;["Your Referral Was Cancelled"]</InnerMethodInvoke>
                <InnerMethodInvoke>patientMsg;setRead;[0]</InnerMethodInvoke>
                <InnerMethodInvoke>messageAction;sendMessage;[patientMsg]</InnerMethodInvoke>
            </InnerMethodInvokeList>
            <ThrowExceptionList>
                <ExceptionType>Exception</ExceptionType>
            </ThrowExceptionList>
        </Method>
    </MethodList>
</Class>